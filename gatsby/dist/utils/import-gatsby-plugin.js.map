{"version":3,"file":"import-gatsby-plugin.js","names":["pluginModuleCache","Map","setGatsbyPluginCache","plugin","module","moduleObject","key","name","set","importGatsbyPlugin","pluginModule","get","importPluginModulePath","resolvedCompiledGatsbyNode","resolve","pluginFilePath","resolveJSFilepath","rootDir","process","cwd","filePath","rawPluginModule","maybeAddFileProtocol","preferDefault"],"sources":["../../src/utils/import-gatsby-plugin.ts"],"sourcesContent":["import {\n  resolveJSFilepath,\n  maybeAddFileProtocol,\n} from \"../bootstrap/resolve-js-file-path\"\nimport { preferDefault } from \"../bootstrap/prefer-default\"\n\nconst pluginModuleCache = new Map<string, any>()\n\nexport function setGatsbyPluginCache(\n  plugin: { name: string; resolve: string },\n  module: string,\n  moduleObject: any\n): void {\n  const key = `${plugin.name}/${module}`\n  pluginModuleCache.set(key, moduleObject)\n}\n\nexport async function importGatsbyPlugin(\n  plugin: {\n    name: string\n    resolve: string\n    resolvedCompiledGatsbyNode?: string\n  },\n  module: string\n): Promise<any> {\n  const key = `${plugin.name}/${module}`\n\n  let pluginModule = pluginModuleCache.get(key)\n\n  if (!pluginModule) {\n    let importPluginModulePath: string\n\n    if (module === `gatsby-node` && plugin.resolvedCompiledGatsbyNode) {\n      importPluginModulePath = plugin.resolvedCompiledGatsbyNode\n    } else {\n      importPluginModulePath = `${plugin.resolve}/${module}`\n    }\n\n    const pluginFilePath = await resolveJSFilepath({\n      rootDir: process.cwd(),\n      filePath: importPluginModulePath,\n    })\n\n    const rawPluginModule = await import(maybeAddFileProtocol(pluginFilePath))\n\n    // If the module is cjs, the properties we care about are nested under a top-level `default` property\n    pluginModule = preferDefault(rawPluginModule)\n\n    pluginModuleCache.set(key, pluginModule)\n  }\n\n  return pluginModule\n}\n"],"mappings":";;;;;;AAAA;;AAIA;;AAEA,MAAMA,iBAAiB,GAAG,IAAIC,GAAJ,EAA1B;;AAEO,SAASC,oBAAT,CACLC,MADK,EAELC,MAFK,EAGLC,YAHK,EAIC;EACN,MAAMC,GAAG,GAAI,GAAEH,MAAM,CAACI,IAAK,IAAGH,MAAO,EAArC;EACAJ,iBAAiB,CAACQ,GAAlB,CAAsBF,GAAtB,EAA2BD,YAA3B;AACD;;AAEM,eAAeI,kBAAf,CACLN,MADK,EAMLC,MANK,EAOS;EACd,MAAME,GAAG,GAAI,GAAEH,MAAM,CAACI,IAAK,IAAGH,MAAO,EAArC;EAEA,IAAIM,YAAY,GAAGV,iBAAiB,CAACW,GAAlB,CAAsBL,GAAtB,CAAnB;;EAEA,IAAI,CAACI,YAAL,EAAmB;IACjB,IAAIE,sBAAJ;;IAEA,IAAIR,MAAM,KAAM,aAAZ,IAA4BD,MAAM,CAACU,0BAAvC,EAAmE;MACjED,sBAAsB,GAAGT,MAAM,CAACU,0BAAhC;IACD,CAFD,MAEO;MACLD,sBAAsB,GAAI,GAAET,MAAM,CAACW,OAAQ,IAAGV,MAAO,EAArD;IACD;;IAED,MAAMW,cAAc,GAAG,MAAM,IAAAC,oCAAA,EAAkB;MAC7CC,OAAO,EAAEC,OAAO,CAACC,GAAR,EADoC;MAE7CC,QAAQ,EAAER;IAFmC,CAAlB,CAA7B;IAKA,MAAMS,eAAe,GAAG,MAAM,OAAO,IAAAC,uCAAA,EAAqBP,cAArB,CAAP,CAA9B,CAdiB,CAgBjB;;IACAL,YAAY,GAAG,IAAAa,4BAAA,EAAcF,eAAd,CAAf;IAEArB,iBAAiB,CAACQ,GAAlB,CAAsBF,GAAtB,EAA2BI,YAA3B;EACD;;EAED,OAAOA,YAAP;AACD"}